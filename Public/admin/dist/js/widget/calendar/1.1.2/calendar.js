/*! zuboke 2015-01-26 */
var $=require("jquery"),moment=require("moment"),BaseCalendar=require("./base-calendar"),DateColumn=require("./date-column"),MonthColumn=require("./month-column"),YearColumn=require("./year-column"),template=['<div class="ui-calendar">','<div class="ui-calendar-pannel" data-role="pannel">','<span class="ui-calendar-control" data-role="prev-year">&lt;&lt;</span>','<span class="ui-calendar-control" data-role="prev-month">&lt;</span>','<span class="ui-calendar-control month" data-role="current-month"></span>','<span class="ui-calendar-control year" data-role="current-year"></span>','<span class="ui-calendar-control" data-role="next-month">&gt;</span>','<span class="ui-calendar-control" data-role="next-year">&gt;&gt;</span>',"</div>",'<div class="ui-calendar-container" data-role="container">',"</div>","</div>"].join(""),Calendar=BaseCalendar.extend({attrs:{mode:"dates",template:template},events:{"click [data-role=current-month]":function(){this.renderContainer("months"===this.get("mode")?"dates":"months")},"click [data-role=current-year]":function(){this.renderContainer("years"===this.get("mode")?"dates":"years")},"click [data-role=prev-year]":function(){var a=this.years.prev();this.dates.select(a),this.months.select(a)},"click [data-role=next-year]":function(){var a=this.years.next();this.dates.select(a),this.months.select(a)},"click [data-role=prev-month]":function(){var a=this.months.prev();this.dates.select(a),this.years.select(a)},"click [data-role=next-month]":function(){var a=this.months.next();this.dates.select(a),this.years.select(a)}},setup:function(){Calendar.superclass.setup.call(this),this.renderPannel();var a={lang:this.get("lang"),focus:this.get("focus"),range:this.get("range"),format:this.get("format"),startDay:this.get("startDay"),process:this.get("process")};this.dates=new DateColumn(a),this.months=new MonthColumn(a),this.years=new YearColumn(a);var b=this;this.dates.on("select",function(a,c){b.set("focus",a);var d=b.get("focus");b.months.select(d),b.years.select(d),c&&(b.trigger("selectDate",a),moment.isMoment(a)&&(a=a.format(this.get("format"))),b.output(a))}),this.months.on("select",function(a,c){var d=b.get("focus");d.month(a),b.set("focus",d),b.renderPannel(),c&&(b.renderContainer("dates",d),b.trigger("selectMonth",d))}),this.years.on("select",function(a,c){var d=b.get("focus");d.year(a),b.set("focus",d),b.renderPannel(),c&&"year"===c.data("role")&&(b.renderContainer("dates",d),b.trigger("selectYear",d))});var c=this.element.find("[data-role=container]");c.append(this.dates.element),c.append(this.months.element),c.append(this.years.element),this.renderContainer("dates")},renderContainer:function(a,b){return this.set("mode",a),b=b||this.get("focus"),this.dates.hide(),this.months.hide(),this.years.hide(),this.dates.select(b,null),this.months.select(b,null),this.years.select(b,null),"dates"===a?this.dates.element.show():"months"===a?this.months.element.show():"years"===a&&this.years.element.show(),this},renderPannel:function(){var a=this.get("focus"),b=this.element.find("[data-role=current-month]"),c=this.element.find("[data-role=current-year]"),d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e=d[a.month()];e=this.get("lang")[e]||e,b.text(e),c.text(a.year())},focus:function(a){a=moment(a,this.get("format")),this.dates.focus(a),this.months.focus(a),this.years.focus(a)},range:function(a){this.set("range",a),this.dates.set("range",a),this.months.set("range",a),this.years.set("range",a),this.renderContainer(this.get("mode")),this.renderPannel()},show:function(){var a=this._outputTime();a&&this.dates.select(a),Calendar.superclass.show.call(this)},destroy:function(){this.dates.destroy(),this.months.destroy(),this.years.destroy(),Calendar.superclass.destroy.call(this)}});Calendar.BaseColumn=require("./base-column"),Calendar.BaseCalendar=BaseCalendar,Calendar.DateColumn=DateColumn,Calendar.MonthColumn=MonthColumn,Calendar.YearColumn=YearColumn,module.exports=Calendar;