/*! zuboke 2015-01-26 */
function parseStartDay(a){if(a=(a||0).toString().toLowerCase(),$.isNumeric(a))return a=parseInt(a,10);for(var b=0;b<DAYS.length;b++)if(0===DAYS[b].indexOf(a)){a=b;break}return a}function createDayModel(a){a=parseStartDay(a);for(var b=[],c=a;7>c;c++)b.push({label:DAY_LABELS[c],value:c});for(c=0;a>c;c++)b.push({label:DAY_LABELS[c],value:c});var d={value:a,label:DAY_LABELS[a]};return{current:d,items:b}}function createDateModel(a,b,c,d,e){var f,g,h,i=[];b=parseStartDay(b);var j=function(a,b){var f={value:a.format(e),label:a.date(),day:a.day(),className:b,available:BaseColumn.isInRange(a,c)};d&&(f.type="date",f=d(f)),i.push(f)},k=a.clone().date(1),l=k.clone().add("months",-1),m=k.clone().add("months",1);if(f=k.day()-b,0>f&&(f+=7),0!=f)for(h=l.daysInMonth(),o=f-1;o>=0;o--)g=l.date(h-o),j(g,"previous-month");for(h=k.daysInMonth(),o=1;h>=o;o++)g=k.date(o),j(g,"current-month");if(f=35-i.length,0!=f)for(0>f&&(f+=7),o=1;f>=o;o++)g=m.date(o),j(g,"next-month");for(var n=[],o=0;o<i.length/7;o++)n.push(i.slice(7*o,7*o+7));var p={value:a.format(e),label:a.date()};return{current:p,items:n}}function template(a,b){var c=b.helpers._,d='<table class="ui-calendar-date" data-role="date-column">';return d+='<tr class="ui-calendar-day-column">',$.each(a.day.items,function(a,b){d+='<th class="ui-calendar-day ui-calendar-day-'+b.value+'" ',d+='data-role="day" data-value="'+b.value+'">',d+=c(b.label),d+="</th>"}),d+="</tr>",$.each(a.date.items,function(a,b){d+='<tr class="ui-calendar-date-column">',$.each(b,function(a,b){var c=["ui-calendar-day-"+b.day,b.className||""];b.available||c.push("disabled-element"),d+='<td class="'+c.join(" ")+'" data-role="date"',d+='data-value="'+b.value+'">',d+=b.label+"</td>"}),d+="</tr>"}),d+="</table>"}var $=require("jquery"),moment=require("moment"),BaseColumn=require("./base-column"),DateColumn=BaseColumn.extend({attrs:{startDay:"Sun",template:template,range:{value:null,setter:function(a){if($.isArray(a)){var b=this.get("format"),c=[];return $.each(a,function(a,d){d=null===d?null:moment(d,b),c.push(d)}),c}return a}},process:null,model:{getter:function(){var a=createDateModel(this.get("focus"),this.get("startDay"),this.get("range"),this.get("process"),this.get("format")),b=createDayModel(this.get("startDay"));return{date:a,day:b}}}},events:{"click [data-role=date]":function(a){var b=$(a.target),c=b.data("value");this.select(c,b)}},prev:function(){var a=this.get("focus").format(this.get("format")),b=this.get("focus").add("days",-1);return this._sync(b,a)},next:function(){var a=this.get("focus").format(this.get("format")),b=this.get("focus").add("days",1);return this._sync(b,a)},select:function(a,b){if(b&&b.hasClass("disabled-element"))return this.trigger("selectDisable",a,b),a;var c=this.get("focus").format(this.get("format"));return this.set("focus",a),this._sync(this.get("focus"),c,b)},focus:function(a){a=a||this.get("focus");var b='[data-value="'+a.format(this.get("format"))+'"]';this.element.find(".focused-element").removeClass("focused-element"),this.element.find(b).addClass("focused-element")},inRange:function(a){return moment.isMoment(a)||(a=moment(a,this.get("format"))),BaseColumn.isInRange(a,this.get("range"))},_sync:function(a,b,c){return this.set("focus",a),a.format("YYYY-MM")!==b&&this.refresh(),this.focus(a),null!==c&&this.trigger("select",a,c),a}});module.exports=DateColumn;var DAYS=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],DAY_LABELS=["Su","Mo","Tu","We","Th","Fr","Sa"];